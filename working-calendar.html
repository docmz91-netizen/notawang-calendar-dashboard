<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isolated Calendar Test (Summary View)</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Minimal styles to support the calendar, avoiding potential conflicts */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            padding: 1rem;
        }
        .calendar-container-wrapper {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 1200px;
            margin: auto;
            padding: 1.5rem;
        }
        /* New styles for the summary labels */
        .day-info-label {
            font-size: 0.7rem; /* 11.2px */
            font-weight: 500;
            padding: 0.125rem 0.375rem; /* 2px 6px */
            border-radius: 0.25rem;
            margin-top: 0.25rem;
            text-align: center;
            white-space: nowrap;
        }
        .payable-label { background-color: #FEF3C7; color: #92400E; }
        .tasks-label { background-color: #DBEAFE; color: #1E40AF; }
        .tasks-label-completed { background-color: #D1FAE5; color: #065F46; }

        .net-amount {
            font-size: 0.7rem;
            font-weight: 600;
        }
        .net-positive { color: #10b981; }
        .net-negative { color: #ef4444; }
    </style>
</head>
<body class="antialiased">

    <h1 class="text-2xl font-bold text-center mb-4">Isolated Calendar Test (Summary View)</h1>
    <p class="text-center text-gray-600 mb-8">This version shows a summary for each day (net amount, payables, and task quantity) as requested.</p>

    <div class="calendar-container-wrapper">
        <div class="flex justify-between items-center mb-4">
            <button id="prevMonth" class="p-2 rounded-full text-gray-600 hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <h2 id="monthYear" class="text-xl font-semibold text-gray-800">Loading...</h2>
            <button id="nextMonth" class="p-2 rounded-full text-gray-600 hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>

        <div class="grid grid-cols-7 text-center font-semibold text-sm text-gray-600 border-b pb-2 mb-2">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
        </div>

        <div id="calendarDates" class="grid grid-cols-7">
            <!-- Calendar dates will be dynamically generated here -->
        </div>
    </div>
    
    <script>
        console.log('ðŸš€ Isolated Calendar Test Initializing...');

        let currentDate = new Date();

        // --- MOCK DATA ---
        const mockDataByDate = new Map();
        const getDateString = (offset) => {
            const d = new Date();
            d.setDate(d.getDate() + offset);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        };
        const formatCurrency = (amount) => `RM${Math.abs(amount).toFixed(2)}`;


        mockDataByDate.set(getDateString(0), {
            tasks: [{ completed: false }, { completed: true }],
            transactions: [{ type: 'income', amount: 500 }, { type: 'expense', amount: 50 }],
            payables: [],
        });
        mockDataByDate.set(getDateString(2), {
            tasks: [{ completed: false }],
            transactions: [],
            payables: [{ amount: 1200 }, { amount: 350 }],
        });
        mockDataByDate.set(getDateString(3), {
            tasks: [{ completed: true }, { completed: true }],
            transactions: [{ type: 'expense', amount: 25.50 }],
            payables: [],
        });
        mockDataByDate.set(getDateString(5), {
            tasks: [],
            transactions: [{ type: 'income', amount: 2500 }],
            payables: [],
        });


        /**
         * Creates a single day cell for the calendar grid with summary labels.
         */
        function createDayCell(day, month, year, isCurrentMonthDay) {
            const dateCell = document.createElement('div');
            dateCell.className = `border p-2 flex flex-col min-h-[100px] ${isCurrentMonthDay ? 'bg-white' : 'bg-gray-50 text-gray-400'}`;
            
            const fullDateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayData = mockDataByDate.get(fullDateString) || {};

            // --- Top row: Date Number and Net Amount ---
            const topRow = document.createElement('div');
            topRow.className = 'flex justify-between items-start w-full';

            const dateNumberSpan = document.createElement('span');
            dateNumberSpan.className = 'font-medium text-sm';
            dateNumberSpan.textContent = day;
            
            const today = new Date();
            if (isCurrentMonthDay && today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                dateNumberSpan.className += ' bg-indigo-600 text-white rounded-full h-6 w-6 flex items-center justify-center';
            }
            topRow.appendChild(dateNumberSpan);

            // Calculate and display Net Amount
            if (dayData.transactions && dayData.transactions.length > 0) {
                const netAmount = dayData.transactions.reduce((acc, t) => acc + (t.type === 'income' ? t.amount : -t.amount), 0);
                const netAmountEl = document.createElement('span');
                netAmountEl.className = `net-amount ${netAmount > 0 ? 'net-positive' : 'net-negative'}`;
                netAmountEl.textContent = (netAmount > 0 ? '+' : '') + formatCurrency(netAmount);
                topRow.appendChild(netAmountEl);
            }
            dateCell.appendChild(topRow);

            // --- Info Labels Container ---
            const labelsContainer = document.createElement('div');
            labelsContainer.className = 'mt-1 w-full';

            // Create Payable Label
            if (dayData.payables && dayData.payables.length > 0) {
                const totalPayable = dayData.payables.reduce((acc, p) => acc + p.amount, 0);
                const payableEl = document.createElement('div');
                payableEl.className = 'day-info-label payable-label';
                payableEl.textContent = `Payable: ${formatCurrency(totalPayable)}`;
                labelsContainer.appendChild(payableEl);
            }

            // Create Task Label
            if (dayData.tasks && dayData.tasks.length > 0) {
                const totalTasks = dayData.tasks.length;
                const completedTasks = dayData.tasks.filter(t => t.completed).length;
                const allCompleted = totalTasks === completedTasks;
                
                const taskEl = document.createElement('div');
                taskEl.className = `day-info-label ${allCompleted ? 'tasks-label-completed' : 'tasks-label'}`;
                taskEl.textContent = `Tasks: ${completedTasks}/${totalTasks}`;
                labelsContainer.appendChild(taskEl);
            }

            dateCell.appendChild(labelsContainer);
            return dateCell;
        }

        /**
         * Renders the main calendar grid.
         */
        function renderCalendar(date) {
            const calendarDatesGrid = document.getElementById('calendarDates');
            const monthYearDisplay = document.getElementById('monthYear');
            
            calendarDatesGrid.innerHTML = '';
            const year = date.getFullYear();
            const month = date.getMonth();
            monthYearDisplay.textContent = new Date(year, month).toLocaleString('en-US', { month: 'long', year: 'numeric' });

            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarDatesGrid.appendChild(document.createElement('div'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                calendarDatesGrid.appendChild(createDayCell(day, month, year, true));
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar(currentDate);
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar(currentDate);
            });

            renderCalendar(currentDate);
            console.log('âœ… Isolated Calendar Test Initialized Successfully');
        });
    </script>
</body>
</html>